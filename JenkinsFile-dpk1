pipeline{
    agent{ label 'jenkins-slave'}

    environment{
        tagId = tagname()
    }

    stages{
        stage('Build Docker file'){
            steps{
                sh " docker build -t deepaksig/node-app-jenkins:${tagId} ."
                sh " echo ${tagId}"
            }
        }

        stage('Push Image'){
            steps{
                sh " docker push deepaksig/node-app-jenkins:${tagId}"
            }
        }
    }
}

def tagname(){
    def commitId = sh(script: "git rev-parse --short HEAD" , returnStdout:true ).trim()
    return commitId
}

