pipeline{
    agent{ label 'jenkins-slave'}

    environment{
        tagId = tagname()
    }

    stages{
        stage('Build Docker file'){
            steps{
                sh " docker build -t deepaksig/node-app-jenkins:${tagId} ."
                sh " echo ${tagId}"
            }
        }

        stage('Push Image'){
            steps{
                sh " docker push deepaksig/node-app-jenkins:${tagId}"               // if its a private repo better add credentials to jenkins and use it here 
            }
        }
    }
}

def tagname(){
    def commitId = sh(script: "git rev-parse --short HEAD" , returnStdout:true ).trim()
    // def commitId = sh(script : "git log -n 1 --preety=format:'%h'" , returnStdout:true).trim()       This also returns the short git commit 
    return commitId
}

